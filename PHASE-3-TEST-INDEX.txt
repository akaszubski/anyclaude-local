PHASE 3: PRODUCTION HARDENING - TEST INDEX
==========================================

Total: 151 tests across 7 files (all FAILING - TDD RED phase)

UNIT TESTS (88 tests)
---------------------

1. test_error_handler.py (22 tests)
   - TestErrorHandlerBasics (5 tests)
   - TestErrorHandlerCacheRecovery (3 tests)
   - TestErrorHandlerOOMDetection (3 tests)
   - TestErrorHandlerNetworkRetry (4 tests)
   - TestErrorHandlerGracefulDegradation (3 tests)
   - TestErrorHandlerEdgeCases (4 tests)

2. test_metrics_collector.py (30 tests)
   - TestMetricsCollectorBasics (5 tests)
   - TestMetricsCollectorLatency (4 tests)
   - TestMetricsCollectorMemory (4 tests)
   - TestMetricsCollectorThroughput (3 tests)
   - TestMetricsCollectorExport (4 tests)
   - TestMetricsCollectorReset (3 tests)
   - TestMetricsCollectorThreadSafety (2 tests)
   - TestMetricsCollectorEdgeCases (5 tests)

3. test_config_validator.py (36 tests)
   - TestConfigValidatorBasics (3 tests)
   - TestConfigValidatorEnvironmentVariables (8 tests)
   - TestConfigValidatorModelPath (6 tests)
   - TestConfigValidatorPortConflicts (4 tests)
   - TestConfigValidatorDependencies (5 tests)
   - TestConfigValidatorComplete (2 tests)
   - TestConfigValidatorEdgeCases (8 tests)

INTEGRATION TESTS (55 tests)
----------------------------

4. test_cache_corruption_recovery.py (21 tests)
   - TestCacheCorruptionDetection (4 tests)
   - TestCacheCorruptionRecovery (4 tests)
   - TestCacheCorruptionGracefulDegradation (3 tests)
   - TestCacheCorruptionWithServer (4 tests)
   - TestCacheCorruptionSecurity (3 tests)
   - TestCacheCorruptionEdgeCases (3 tests)

5. test_mlx_server_stress.py (14 tests, 2 skipped)
   - TestSequentialStress (3 tests)
   - TestConcurrentStress (4 tests)
   - TestLongRunningSession (2 tests - skipped, manual only)
   - TestMemoryLeakDetection (3 tests)
   - TestStressTestEdgeCases (2 tests)

6. test_metrics_endpoint.py (20 tests)
   - TestMetricsEndpointBasics (6 tests)
   - TestMetricsEndpointPrometheus (3 tests)
   - TestMetricsEndpointRealTime (3 tests)
   - TestMetricsEndpointErrorHandling (3 tests)
   - TestMetricsEndpointSecurity (3 tests)
   - TestMetricsEndpointFiltering (2 tests)

REGRESSION TESTS (8 tests)
--------------------------

7. test_error_recovery_regression.js (8 tests)
   - Cache corruption doesn't crash server
   - OOM condition doesn't crash server
   - Network timeouts retry with exponential backoff
   - Graceful degradation continues serving requests
   - Recovery from degraded mode
   - Concurrent errors don't cause race conditions
   - Error logs are sanitized (VUL-003)
   - Server starts with corrupted cache

RUN COMMANDS
------------

# All unit tests
python3 tests/unit/test_error_handler.py
python3 tests/unit/test_metrics_collector.py
python3 tests/unit/test_config_validator.py

# All integration tests
python3 tests/integration/test_cache_corruption_recovery.py
python3 tests/integration/test_mlx_server_stress.py
python3 tests/integration/test_metrics_endpoint.py

# Regression tests
node tests/regression/test_error_recovery_regression.js

# Long-running tests (manual, 2-4 hours)
python3 tests/integration/test_mlx_server_stress.py \
  TestLongRunningSession.test_2_hour_session_stability
python3 tests/integration/test_mlx_server_stress.py \
  TestLongRunningSession.test_4_hour_session_no_memory_leak

EXPECTED RESULTS (TDD RED PHASE)
--------------------------------

All 151 tests should FAIL with:
- Unit tests: NotImplementedError: <Module> not yet implemented
- Integration tests: NotImplementedError: <Module> not yet implemented
- Regression tests: Error: <Module> not yet implemented

IMPLEMENTATION ORDER
-------------------

1. scripts/lib/error_handler.py (51 tests depend on this)
2. scripts/lib/metrics_collector.py (50 tests depend on this)
3. scripts/lib/config_validator.py (36 tests depend on this)
4. scripts/mlx-server.py integration (add /v1/metrics endpoint)

TDD GREEN PHASE
--------------

After implementation, all 151 tests should PASS:
- Run: python3 -m unittest discover tests/unit
- Run: python3 -m unittest discover tests/integration
- Run: node tests/regression/test_error_recovery_regression.js
- Expected: 151 passed, 0 failed, 2 skipped (long-running)

COVERAGE GOALS
-------------

- error_handler.py: 80%+ (22 unit + 21 integration + 8 regression = 51 tests)
- metrics_collector.py: 80%+ (30 unit + 20 integration = 50 tests)
- config_validator.py: 80%+ (36 unit tests)

SECURITY TESTS
-------------

- VUL-003 (file path sanitization):
  - test_error_handler.py::test_sanitize_error_message_removes_file_paths
  - test_cache_corruption_recovery.py::TestCacheCorruptionSecurity

- Thread safety:
  - test_metrics_collector.py::TestMetricsCollectorThreadSafety
  - test_mlx_server_stress.py::test_concurrent_requests_cache_thread_safety

- Input validation:
  - test_config_validator.py (all 36 tests)

- Graceful degradation:
  - test_error_handler.py::TestErrorHandlerGracefulDegradation
  - test_cache_corruption_recovery.py::TestCacheCorruptionGracefulDegradation

PERFORMANCE TARGETS
------------------

- Sequential: 100 requests, >90% success
- Latency: P95 < 2x P50
- Memory: < 20% growth over 100 requests
- Concurrent: 10 simultaneous, all complete
- Long-running: 2-4 hours, <5% failure, <20% memory growth

EOF
